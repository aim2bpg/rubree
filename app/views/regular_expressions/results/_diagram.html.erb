<div data-controller="diagram-modal">
  <div class="flex flex-col space-y-2 overflow-auto rounded border border-gray-700 bg-gray-900 p-4 min-h-[140px] text-white text-left relative">
    <% if @diagram_error_message.present? %>
      <label class="text-sm font-bold text-white">Railroad diagram:</label>
      <div class="bg-red-100 border-4 border-double border-red-600 text-red-800 p-4 rounded-md font-semibold whitespace-pre-wrap mb-2">
        <%= h @diagram_error_message %>
      </div>

    <% elsif @svg_output.present? %>
      <div class="flex justify-between items-center mb-1">
        <label class="text-sm font-bold text-white">Railroad diagram:</label>

        <div class="flex items-center gap-2">
          <!-- Modal open button -->
          <button
            type="button"
            class="p-0 text-gray-400 hover:text-white transition w-5 h-5 flex items-center justify-center"
            aria-label="View Full Diagram"
            data-action="click->diagram-modal#open">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              class="w-[18px] h-[18px]">
              <circle cx="11" cy="11" r="7" stroke-width="2" />
              <line x1="16.656" y1="16.657" x2="21" y2="21" stroke-width="2" stroke-linecap="round" />
            </svg>
          </button>
        </div>
      </div>

      <div
        data-controller="drag-scroll"
        class="w-full overflow-auto whitespace-nowrap cursor-grab border border-gray-600 rounded p-2 bg-gray-800 max-h-[400px]"
        data-diagram-modal-target="source">
        <%= regular_expression.diagram_svg %>
      </div>

    <% else %>
      <p class="text-gray-500 m-auto text-center">Railroad diagram will appear here</p>
    <% end %>
  </div>

  <!-- Modal container -->
  <div
    data-diagram-modal-target="modal"
    class="modal hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50"
    data-action="click->diagram-modal#close">
    <div
      class="relative bg-white rounded shadow-lg p-4 max-w-[90vw] max-h-[90vh] overflow-auto"
      data-action="click->diagram-modal#stopPropagation">
      <button
        type="button"
        class="absolute top-2 right-2 text-gray-500 hover:text-gray-800"
        data-action="click->diagram-modal#close"
        aria-label="Close">
        âœ•
      </button>

      <div
        data-diagram-modal-target="content"
        class="overflow-auto max-w-full cursor-grab max-h-[80vh]"
        data-controller="drag-scroll"></div>
    </div>
  </div>
</div>
